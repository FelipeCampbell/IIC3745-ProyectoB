<%= form_for @movie do |form| %>
  <% if movie.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(movie.errors.count, "error") %> prohibited this movie from being saved:</h2>

      <ul>
        <% movie.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :name %>
    <%= form.text_field :name %>
  </div>
  <div class="field">
    <%= form.label :image %>
    <%= form.text_field :image %>
  </div>

  <%= form.fields_for :planners do |f| %>
    <% if (f.options[:child_index] == 0) %>
      <div class="field">
      <%= f.label "Start Date" %>
      <%= f.date_field :start_date %>
      </div>
      <div class="field">
          <%= f.label "End Date" %>
          <%= f.date_field :end_date %>
      </div>
    <% end%>
    <%= render 'planner_fields', f:f%>
  <% end %>
  <%= link_to_add_fields "Add Another Room/Time", form, :planners%>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>

<script>
  $('form').on('click', '.add_fields', function(event){
    event.preventDefault();
    const index = parseInt($(this)[0].id) + 1;
    const originalDataFields = $(this).attr("data-fields");
    $(this).data("fields", originalDataFields.replaceAll($(this).attr("data-id"), index));
    $(this)[0].id = index;
    $(this).before($(this).data('fields'));
  })
</script>
