<p id="notice"><%= notice %></p>

<div style="display: flex;">
<div style='width: 50%;'>
<h1 class="title">Cartelera</h1>
</div>
<div style='width: 50%;text-align:right;padding-top:30px'>
<% if params[:admin] %>
  <a class="button" href="<%= new_movie_path%>">
    Agregar película
  </a>
<% end %>
</div>
</div>

<div class="parent">
  <% @movies.each do |movie| %>
    <%
    planners = {}
    movie.planners.each do |planner|
      if !planners.include?(planner.room)
        planners[planner.room] = [planner.time]
      else 
        planners[planner.room] << planner.time
      end
    end
    %>

    <div class="card">
      <img class="movie-image" src="<%= movie.image %>">
      <div class="container">
        <div class="title"><%= movie.name %></div>
          <%
            if planners.length > 0
              planner = movie.planners[0]
          %>
            <div class="dates">
              <div>
                <strong>Desde:</strong>
                <%= planner.start_date.to_s.gsub('-', '/') %>
              </div>

              <div>
                <strong>Hasta:</strong>
                <%= planner.end_date.to_s.gsub('-', '/') %>
              </div>
            </div>
            
          <% end %>
        <% planners.each do |room, times| %>
          <div class="room-time">
            <span>
              <strong>Sala:</strong>
              <%= room %>
            </span>

            <% if times.include?(1)%>
              <%= link_to "Matiné", new_movie_path(:movie_id => movie.id, :room => room, :time => 1 ) %> 
            <% end %>
            <% if times.include?(2)%>
              <%= link_to "Tanda", new_movie_path(:movie_id => movie.id, :room => room, :time => 2 ) %> 
            <% end %>
            <% if times.include?(3)%>
              <%= link_to "Noche", new_movie_path(:movie_id => movie.id, :room => room, :time => 3 ) %> 
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<br>
